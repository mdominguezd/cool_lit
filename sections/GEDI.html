<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>gedi ‚Äì Lit literature review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lit literature review</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../sections/GEDI.html" aria-current="page"> 
<span class="menu-text">GEDI</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../sections/forest_fires.html"> 
<span class="menu-text">Forest fires</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../sections/other_satellites.html"> 
<span class="menu-text">Other satellites</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#repeat-gedi-footprints-measure-the-effects-of-tropical-forest-disturbances-2024" id="toc-repeat-gedi-footprints-measure-the-effects-of-tropical-forest-disturbances-2024" class="nav-link active" data-scroll-target="#repeat-gedi-footprints-measure-the-effects-of-tropical-forest-disturbances-2024">Repeat GEDI footprints measure the effects of tropical forest disturbances (2024)</a></li>
  <li><a href="#characterizing-the-structural-complexity-of-the-earths-forests-with-spaceborne-lidar" id="toc-characterizing-the-structural-complexity-of-the-earths-forests-with-spaceborne-lidar" class="nav-link" data-scroll-target="#characterizing-the-structural-complexity-of-the-earths-forests-with-spaceborne-lidar">Characterizing the structural complexity of the Earth‚Äôs forests with spaceborne lidar</a></li>
  <li><a href="#on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake" id="toc-on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake" class="nav-link" data-scroll-target="#on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake">On the NASA GEDI and ESA CCI biomass maps: aligning for uptake in the UNFCCC global stocktake</a></li>
  <li><a href="#on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake-1" id="toc-on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake-1" class="nav-link" data-scroll-target="#on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake-1">On the NASA GEDI and ESA CCI biomass maps: Aligning for uptake in the UNFCCC global stocktake</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="repeat-gedi-footprints-measure-the-effects-of-tropical-forest-disturbances-2024" class="level2">
<h2 class="anchored" data-anchor-id="repeat-gedi-footprints-measure-the-effects-of-tropical-forest-disturbances-2024"><a href="https://www.sciencedirect.com/science/article/pii/S0034425724001925?via%3Dihub#f0005">Repeat GEDI footprints measure the effects of tropical forest disturbances (2024)</a></h2>
<section id="main-ideas" class="level3">
<h3 class="anchored" data-anchor-id="main-ideas">Main ideas</h3>
<ul>
<li>(<span class="emoji" data-emoji="rocket">üöÄ</span><span class="emoji" data-emoji="satellite">üì°</span><span class="emoji" data-emoji="link">üîó</span>) A method to examine forest changes using nearby GEDI footprints was developed.</li>
<li>(<span class="emoji" data-emoji="evergreen_tree">üå≤</span><span class="emoji" data-emoji="fallen_leaf">üçÇ</span>) GEDI is able to capture biomass/canopy height losses after disturbances
<ul>
<li>In 30x30m resolution</li>
<li>At a population level</li>
</ul></li>
<li>(<span class="emoji" data-emoji="deciduous_tree">üå≥</span> &amp; <span class="emoji" data-emoji="herb">üåø</span>) GEDI 3D view can also show different disturbance dynamics.
<ul>
<li>e.g.&nbsp;Only under-story loss after fires</li>
</ul></li>
<li>(<span class="emoji" data-emoji="chart_with_upwards_trend">üìà</span>) GEDI biomass loss and Landsat AFC disturbance metrics are related.
<ul>
<li>Opens possibility of ML models for extrapolating.</li>
</ul></li>
<li>(<span class="emoji" data-emoji="bulb">üí°</span>) GEDI can measure C emissions without new optical-detected disturbance.</li>
</ul>
</section>
<section id="intro" class="level3">
<h3 class="anchored" data-anchor-id="intro">Intro</h3>
<section id="important-contextual-info" class="level4">
<h4 class="anchored" data-anchor-id="important-contextual-info">Important contextual info</h4>
<ul>
<li>Magnitude of carbon losses due to forest disturbance lacks scientific consensus.
<ul>
<li>(29 - 73% of total carbon loss in tropical forests)</li>
</ul></li>
<li>Forest disturbances are already well detected (GLAD + AFC), but carbon loss estimation associated is still challenging (esp.&nbsp;tropics)</li>
<li>Ideal tool: Annual biomass map created using frequent and consistent sensor (e.g.&nbsp;Optical and/or SAR).
<ul>
<li>However, this doesn‚Äôt exist. A problem: SAR tends to saturate with high biomass :/.</li>
</ul></li>
<li>GEDI can‚Äôt be used as the tool to monitor disturbances (No repeated cycles and affected by clouds).
<ul>
<li>But, in some cases where disturbances have happened. It can be used to quantify the effect of those disturbances.</li>
</ul></li>
</ul>
</section>
</section>
<section id="methods" class="level3">
<h3 class="anchored" data-anchor-id="methods">Methods</h3>
<ol type="1">
<li><p>Pipeline for identifying spatially coincident GEDI shots with intervening forest changes detected by another wall-to-wall sensor.</p></li>
<li><p>Created a <em>treatment</em> with intervening disturbances (13700), and a fair <em>control</em> group against which to test for statistical significance (65000 pairs) <a href="#fig-groups" class="quarto-xref">Figure&nbsp;1</a>. Assuming homogeneity at d&lt;40m.</p></li>
<li><p>Compared both groups to check if GEDI can measure biomass and canopy height loss at population level. (Used GLAD and AFC pairs)</p>
<ol type="1">
<li><p>(1:1 relationship on control)</p></li>
<li><p>S2 - S1 &lt; 0 in treatment.</p></li>
</ol></li>
<li><p>Studied relationships of disturbance extent, time since disturbance and disturbance intensity with biomass loss estimated by GEDI. (Used AFC pairs)</p></li>
<li><p>Evaluated impacts of fires in the forest structure (e.g.&nbsp;Subcanopy loss). (GLAD pairs U MODIS burned area {614 pairs})</p></li>
</ol>
<div id="fig-groups" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S0034425724001925-gr1.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Image taken from <a href="https://www.sciencedirect.com/science/article/pii/S0034425724001925?via%3Dihub#f0005" class="uri">https://www.sciencedirect.com/science/article/pii/S0034425724001925?via%3Dihub#f0005</a>
</figcaption>
</figure>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<ul>
<li>Control groups showed 1:1 relationship, but slightly noisier when considering areas were disturbances have happened.</li>
<li>Mean biomass loss was significantly higher in treatment than control for both AFC and GLAD. <span class="math inline">\(\rightarrow\)</span> Biomass loss can be estimated by GEDI. (Also for only degradation (Subset with AFC))</li>
<li>Linear relationship between biomass loss and disturbance extent, complex with time since disturbance and square relationship with disturbance intensity.</li>
<li>Forest structural changes detected after fires showed that 65% of samples didn‚Äôt have canopy losses. and in 35% of this canopy preserved samples big part of under-story was lost.</li>
</ul>
<section id="personal-ideas" class="level4">
<h4 class="anchored" data-anchor-id="personal-ideas">Personal ideas</h4>
<ul>
<li>How important it is for Carbon models to differentiate if the biomass loss is due to deforestation or due to forest disturbance?
<ul>
<li>Maybe not for Carbon models, but it is important for ecological reasons (Ecosystem services).</li>
</ul></li>
<li>What is the viability of this being reproduce in Europe?
<ul>
<li>GEDI coverage (Lats. &lt; 51.6¬∫)</li>
</ul></li>
<li>For checking structural changes checking the Waveform Structrutal Complexity Index product could also be feasible? Check <a href="https://www.nature.com/articles/s41467-024-52468-2">this</a>.</li>
</ul>
</section>
</section>
</section>
<section id="characterizing-the-structural-complexity-of-the-earths-forests-with-spaceborne-lidar" class="level2">
<h2 class="anchored" data-anchor-id="characterizing-the-structural-complexity-of-the-earths-forests-with-spaceborne-lidar"><a href="https://www.nature.com/articles/s41467-024-52468-2">Characterizing the structural complexity of the Earth‚Äôs forests with spaceborne lidar</a></h2>
<section id="main-ideas-1" class="level3">
<h3 class="anchored" data-anchor-id="main-ideas-1">Main ideas</h3>
<ul>
<li><p>Forest structural complexity has a major influence on ecosystem functioning and biodiversity.</p></li>
<li><p>A 3D canopy complexity data product was derived from space-borne LiDAR (GEDI) measurements (<a href="https://daac.ornl.gov/GEDI/guides/GEDI_L4C_WSCI.html">data</a>).</p>
<ul>
<li>Trained with ALS 3D complexity measurements (In-situ).</li>
</ul></li>
<li><p>(üåé Spatial variations) Highest complexity is present in tropical forests and this complexity is related to canopy attributes from lower and middle story.</p></li>
</ul>
</section>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<ul>
<li><p><strong>Forest structural complexity</strong> is a function of the heterogeneity of canopy structure in tri-dimensional space.</p>
<ul>
<li><p>Determined by:</p>
<ul>
<li><p>üå≥Tree diameter</p></li>
<li><p>üìè Height</p></li>
<li><p>üå≤ Biomass</p></li>
<li><p>üçÉLeaf angle</p></li>
<li><p><span class="emoji" data-emoji="wood">ü™µ</span> Deadwood</p></li>
<li><p>Vertical layering</p></li>
</ul></li>
</ul></li>
<li><p>GEDI waveforms record vertical distribution of leaves and branches from top of canopy to ground.</p></li>
</ul>
</section>
<section id="methods-1" class="level3">
<h3 class="anchored" data-anchor-id="methods-1">Methods</h3>
<ul>
<li>GEDI records vertical variations. Assuming that vertical and horizontal variations are related, authors tried to inferred 3D complexity out of GEDI records alone.</li>
<li><blockquote class="blockquote">
<p>800,000 measured values of CE<span class="math inline">\(_{xyz}\)</span> were used to model the structural complexity.</p>
</blockquote></li>
<li>Extreme gradient boosted trees regression model was trained <span class="math display">\[ CE_{xyz} = XGBoost(GEDI_{L2}) \]</span></li>
<li>Separate regression models were developed for each plant functional type (PFT): Evergreen Broadleef Trees (EBT), Deciduous Broadleef Tree (DBT), Evergreen Needleaf Trees (ENT) and Grasslands Shrublands, and Woodlands (GSW).</li>
<li>Model uncertainty was quantified using conformal predictors (?).</li>
<li>Spatial cross-validation was used to assess the performance.</li>
<li>A PCA was performed to understand WSCI and</li>
</ul>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<ul>
<li>The models resulted in a R<span class="math inline">\(^{2}\)</span> of 68% in the training data.</li>
<li>Vertical complexity is better predicted (75%) than horizontal complexity (40%). Also it is mainly predicted by upper strata metrics.
<ul>
<li>Explained by: As canopy height increases, vertical layering also develops, increasing tree density.</li>
</ul></li>
</ul>
</section>
</section>
<section id="on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake" class="level2">
<h2 class="anchored" data-anchor-id="on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake"><a href="https://doi.org/10.1088/1748-9326/ad0b60">On the NASA GEDI and ESA CCI biomass maps: aligning for uptake in the UNFCCC global stocktake</a></h2>
<p>A cmparison between GEDI agbd estimations and Climate Change Initiative Biomass estimations. Also, these were compared with National Forest Inventories (NFIs).</p>
<p>Main finding: Both products show strong correlation to NFI-estimated AGBD, with no systematic deviations. These results are remarkably promising, and to support the operational use of AGB map products for policy reporting</p>
</section>
<section id="on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake-1" class="level2">
<h2 class="anchored" data-anchor-id="on-the-nasa-gedi-and-esa-cci-biomass-maps-aligning-for-uptake-in-the-unfccc-global-stocktake-1"><a href="https://www.doi.org/10.1088/1748-9326/ad0b60">On the NASA GEDI and ESA CCI biomass maps: Aligning for uptake in the UNFCCC global stocktake</a></h2>
<section id="main-ideas-2" class="level3">
<h3 class="anchored" data-anchor-id="main-ideas-2">Main ideas</h3>
<ul>
<li>Earth Observation data can effectively estimate forest aboveground biomass density (AGBD) in line with UNFCCC principles, but their use for national-level reporting is minimal as of 2023, coinciding with the end of the first Global Stocktake (GST).</li>
<li>A comparison of AGBD estimates from NASA‚Äôs GEDI and ESA‚Äôs CCI reveals significant differences, particularly in the Congolese lowlands and east/southeast Asia, while showing strong correlation with National Forest Inventories (NFIs) in regions like Peru and Mexico</li>
<li>The study emphasizes the need for alignment between scientific teams to enhance the operational use of AGBD maps for policy reporting, recommending consistent statistical terminology and a rigorous framework for uncertainty estimation.</li>
<li>The authors advocate for user-friendly documentation and tools that facilitate the integration of NFIs with AGBD products, aiming to improve the accuracy of national biomass estimates and ensure that space agencies provide reliable global biomass data for policy impact.</li>
</ul>
</section>
<section id="uncertainty-estimation-standardization" class="level3">
<h3 class="anchored" data-anchor-id="uncertainty-estimation-standardization">Uncertainty estimation standardization</h3>
<p>‚ÄúLarge differences exist not only between the map AGBD estimates, but also in the analytical frameworks used to estimate uncertainties, their underlying scope, definitions, assumptions and level of transparency.‚Äù</p>
<p>Then scientific community should: - Align uncertainty assessment frameworks <font color="blue">(<strong>GEDI &gt; CCI</strong> The GEDI products clearly show how to measure the accuracy of AGBD predictions, making it easier to follow IPCC guidelines for large areas.)</font> - Provide source codes for large area estimations.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mdominguezd\.github\.io\/cool_lit\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>